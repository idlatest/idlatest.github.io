---
import { getCollection } from "astro:content";

import BaseLayout from '../../../layouts/BaseLayout.astro';
import BlogPost from '../../../components/BlogPost.astro'
import Pagination from '../../../components/Pagination.astro'

export async function getStaticPaths({ paginate }) {
  const allPosts = await getCollection('posts');
  const recentPosts = allPosts.sort((a,b) => new Date(b.data.publishDate) - new Date(a.data.publishDate));
  const uniqueTags = [...new Set(allPosts.map(post => post.data.tags).flat())];

  return uniqueTags.flatMap(tag => {
const filteredPosts = recentPosts.filter(post => post.data.tags.includes(tag))

  return paginate(filteredPosts, { params: { tag }, pageSize: 10 })
  })
}

const { page } = Astro.props;
const { tag } = Astro.params;

---
<BaseLayout pageTitle={tag}>
  <h1 class="text-5xl text-slate-900 font-bold leading-tight dark:text-white lg:max-w-md">Posts tagged with <span class="text-blue-500 dark:text-blue-400">{tag}</span></h1>
  <ul>
    {page.data.map(post => <BlogPost post={post} />)}
  </ul>
  <Pagination page={page} />
</BaseLayout>
